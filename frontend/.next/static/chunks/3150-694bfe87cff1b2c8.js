"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3150],{88524:(e,s,a)=>{a.d(s,{A0:()=>i,BF:()=>d,Hj:()=>n,XI:()=>c,nA:()=>x,nd:()=>o});var r=a(95155),l=a(12115),t=a(53999);let c=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:s,className:(0,t.cn)("w-full caption-bottom text-sm",a),...l})})});c.displayName="Table";let i=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)("thead",{ref:s,className:(0,t.cn)("[&_tr]:border-b",a),...l})});i.displayName="TableHeader";let d=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)("tbody",{ref:s,className:(0,t.cn)("[&_tr:last-child]:border-0",a),...l})});d.displayName="TableBody",l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)("tfoot",{ref:s,className:(0,t.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...l})}).displayName="TableFooter";let n=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)("tr",{ref:s,className:(0,t.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...l})});n.displayName="TableRow";let o=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)("th",{ref:s,className:(0,t.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...l})});o.displayName="TableHead";let x=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)("td",{ref:s,className:(0,t.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...l})});x.displayName="TableCell",l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)("caption",{ref:s,className:(0,t.cn)("mt-4 text-sm text-muted-foreground",a),...l})}).displayName="TableCaption"},93150:(e,s,a)=>{a.d(s,{N:()=>Z});var r=a(95155),l=a(12115),t=a(92188),c=a(97168);a(88145);var i=a(88482),d=a(95139),n=a(63872),o=a(89852),x=a(82714),m=a(95784),u=a(88524),h=a(16559),j=a(84616),p=a(92657),f=a(13717),N=a(62525),v=a(381),g=a(17580),b=a(69074),w=a(57434),y=a(37108),A=a(72713),R=a(75525),C=a(40133),T=a(4229),S=a(91788),E=a(47924),L=a(5196),k=a(54416),P=a(56671),z=a(55502),_=a(88255),O=a(53999);let F=["create","read","update","delete","manage"],B={create:"Criar",read:"Visualizar",update:"Editar",delete:"Excluir",manage:"Gerenciar"},I={create:j.A,read:p.A,update:f.A,delete:N.A,manage:v.A},V={[t.Rx.USERS]:g.A,[t.Rx.PATIENTS]:g.A,[t.Rx.APPOINTMENTS]:b.A,[t.Rx.PRESCRIPTIONS]:w.A,[t.Rx.INVENTORY]:y.A,[t.Rx.REPORTS]:A.A};function Z(e){let{user:s,role:a,mode:j="overview",editable:p=!1,showActions:f=!0,className:N}=e,[v,g]=(0,l.useState)(""),[b,w]=(0,l.useState)("all"),[y,A]=(0,l.useState)(a||"all"),[Z,H]=(0,l.useState)({}),[M,q]=(0,l.useState)(!1),[$,W]=(0,l.useState)(!1),{data:Y,isLoading:Q}=(0,z.vt)(),{data:U,isLoading:X}=(0,z.Sk)(),{data:D,isLoading:G}=(0,z.VU)(null==s?void 0:s.id,{enabled:!!s&&"user"===j}),{data:J,isLoading:K}=(0,z.wE)({enabled:"overview"===j}),ee=(0,_.t3)(),es=(0,l.useMemo)(()=>Y?Y.filter(e=>{var s;let a=e.name.toLowerCase().includes(v.toLowerCase())||(null==(s=e.description)?void 0:s.toLowerCase().includes(v.toLowerCase())),r="all"===b||e.resource_type===b;return a&&r}):[],[Y,v,b]),ea=(e,s)=>"".concat(e,":").concat(s),er=(e,s)=>{let a=ea(e,s);return"user"===j&&D?D.some(a=>a.resource_type===e&&a.action===s):Z.hasOwnProperty(a)?Z[a]:y===t.QY.ADMIN},el=async()=>{if(!y||"all"===y)return void P.o.error("Selecione um perfil para salvar as altera\xe7\xf5es");try{let e=Object.entries(Z).map(e=>{let[s,a]=e,[r,l]=s.split(":");return{resource_type:r,action:l,enabled:a}});await ee.mutateAsync({role:y,permissions:e}),H({}),q(!1),W(!1),P.o.success("Permiss\xf5es atualizadas com sucesso!")}catch(e){P.o.error("Erro ao atualizar permiss\xf5es")}},et=e=>V[e]||R.A;return Q||X||G||K?(0,r.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,r.jsx)(n.LoadingSpinner,{size:"lg"})}):(0,r.jsxs)("div",{className:(0,O.cn)("space-y-6",N),children:[(0,r.jsxs)("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold tracking-tight",children:"Matriz de Permiss\xf5es"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"user"===j&&s?"Permiss\xf5es do usu\xe1rio ".concat(s.full_name):"role"===j&&"all"!==y?"Permiss\xf5es do perfil ".concat(y):"Vis\xe3o geral das permiss\xf5es do sistema"})]}),f&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[M&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>{H({}),q(!1)},children:[(0,r.jsx)(C.A,{className:"mr-2 h-4 w-4"}),"Resetar"]}),(0,r.jsxs)(c.$,{size:"sm",onClick:()=>W(!0),children:[(0,r.jsx)(T.A,{className:"mr-2 h-4 w-4"}),"Salvar Altera\xe7\xf5es"]})]}),(0,r.jsxs)(c.$,{variant:"outline",size:"sm",children:[(0,r.jsx)(S.A,{className:"mr-2 h-4 w-4"}),"Exportar"]})]})]}),(0,r.jsx)(i.Zp,{children:(0,r.jsx)(i.Wu,{className:"pt-6",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(x.Label,{htmlFor:"search",children:"Buscar Recursos"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(E.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(o.p,{id:"search",placeholder:"Buscar por nome ou descri\xe7\xe3o...",value:v,onChange:e=>g(e.target.value),className:"pl-10"})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(x.Label,{htmlFor:"resource-filter",children:"Filtrar por Recurso"}),(0,r.jsxs)(m.l6,{value:b,onValueChange:w,children:[(0,r.jsx)(m.bq,{children:(0,r.jsx)(m.yv,{placeholder:"Todos os recursos"})}),(0,r.jsxs)(m.gC,{children:[(0,r.jsx)(m.eb,{value:"all",children:"Todos os recursos"}),Object.values(t.Rx).map(e=>{let s=et(e);return(0,r.jsx)(m.eb,{value:e,children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(s,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"capitalize",children:e})]})},e)})]})]})]}),"user"!==j&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(x.Label,{htmlFor:"role-filter",children:"Filtrar por Perfil"}),(0,r.jsxs)(m.l6,{value:y,onValueChange:A,children:[(0,r.jsx)(m.bq,{children:(0,r.jsx)(m.yv,{placeholder:"Todos os perfis"})}),(0,r.jsxs)(m.gC,{children:[(0,r.jsx)(m.eb,{value:"all",children:"Todos os perfis"}),Object.values(t.QY).map(e=>(0,r.jsx)(m.eb,{value:e,children:e},e))]})]})]})]})})}),(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsxs)(i.ZB,{className:"flex items-center",children:[(0,r.jsx)(R.A,{className:"mr-2 h-5 w-5"}),"Matriz de Permiss\xf5es"]}),(0,r.jsx)(i.BT,{children:p?"Clique nas c\xe9lulas para alterar as permiss\xf5es":"Visualiza\xe7\xe3o das permiss\xf5es atuais"})]}),(0,r.jsxs)(i.Wu,{children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(u.XI,{children:[(0,r.jsx)(u.A0,{children:(0,r.jsxs)(u.Hj,{children:[(0,r.jsx)(u.nd,{className:"w-[200px]",children:"Recurso"}),F.map(e=>{let s=I[e];return(0,r.jsx)(u.nd,{className:"text-center",children:(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-1",children:[(0,r.jsx)(s,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:B[e]})]})},e)})]})}),(0,r.jsx)(u.BF,{children:es.map(e=>{let s=et(e.resource_type);return(0,r.jsxs)(u.Hj,{children:[(0,r.jsx)(u.nA,{children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(s,{className:"h-5 w-5 text-muted-foreground"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium",children:e.name}),e.description&&(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:e.description})]})]})}),F.map(s=>{let a=er(e.resource_type,s),l=p&&"all"!==y;return(0,r.jsx)(u.nA,{className:"text-center",children:(0,r.jsx)("div",{className:"flex justify-center",children:l?(0,r.jsx)(d.S,{checked:a,onCheckedChange:()=>((e,s)=>{if(!p)return;let a=ea(e,s),r=er(e,s);H(e=>({...e,[a]:!r})),q(!0)})(e.resource_type,s),className:"h-5 w-5"}):(0,r.jsx)("div",{className:(0,O.cn)("flex items-center justify-center w-5 h-5 rounded",a?"bg-green-100 text-green-600":"bg-gray-100 text-gray-400"),children:a?(0,r.jsx)(L.A,{className:"h-3 w-3"}):(0,r.jsx)(k.A,{className:"h-3 w-3"})})})},s)})]},e.id)})})]})}),0===es.length&&(0,r.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,r.jsx)(R.A,{className:"mx-auto h-12 w-12 mb-4 opacity-50"}),(0,r.jsx)("p",{children:"Nenhum recurso encontrado"}),(0,r.jsx)("p",{className:"text-sm",children:"Tente ajustar os filtros de busca"})]})]})]}),(0,r.jsxs)(i.Zp,{children:[(0,r.jsx)(i.aR,{children:(0,r.jsx)(i.ZB,{className:"text-sm",children:"Legenda"})}),(0,r.jsx)(i.Wu,{children:(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:F.map(e=>{let s=I[e];return(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(s,{className:(0,O.cn)("h-4 w-4",{create:"text-green-600",read:"text-blue-600",update:"text-yellow-600",delete:"text-red-600",manage:"text-purple-600"}[e])}),(0,r.jsx)("span",{className:"text-sm",children:B[e]})]},e)})})})]}),(0,r.jsx)(h.Lt,{open:$,onOpenChange:W,children:(0,r.jsxs)(h.EO,{children:[(0,r.jsxs)(h.wd,{children:[(0,r.jsxs)(h.r7,{className:"flex items-center",children:[(0,r.jsx)(T.A,{className:"mr-2 h-5 w-5"}),"Salvar Altera\xe7\xf5es"]}),(0,r.jsxs)(h.$v,{children:["Tem certeza que deseja salvar as altera\xe7\xf5es nas permiss\xf5es do perfil ",(0,r.jsx)("strong",{children:y}),"?",(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),"Esta a\xe7\xe3o ir\xe1 afetar todos os usu\xe1rios com este perfil."]})]}),(0,r.jsxs)(h.ck,{children:[(0,r.jsx)(h.Zr,{children:"Cancelar"}),(0,r.jsxs)(h.Rx,{onClick:el,children:[ee.isPending?(0,r.jsx)(n.LoadingSpinner,{size:"sm",className:"mr-2"}):null,"Salvar Altera\xe7\xf5es"]})]})]})})]})}}}]);