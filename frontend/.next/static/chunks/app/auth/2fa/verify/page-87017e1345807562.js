(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[15],{4208:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>N});var r=a(95155),s=a(12115),o=a(35695),i=a(75525),n=a(53904),l=a(35169),c=a(97168),d=a(88482),u=a(89852),m=a(82714),g=a(49026),h=a(76037),p=a(56671),f=a(95954);function x(e){let{onVerified:t,onBack:a,userEmail:o,rememberDevice:x=!1}=e,[v,b]=(0,s.useState)(""),[w,j]=(0,s.useState)(""),[N,y]=(0,s.useState)(!1),[E,k]=(0,s.useState)(!1),[F,C]=(0,s.useState)(0),[A,S]=(0,s.useState)(!1),[T,D]=(0,s.useState)(0),R=async()=>{let e=E?w.trim():v.trim();if(!e)return void p.o.error("Digite o c\xf3digo de verifica\xe7\xe3o");if(!E&&6!==e.length)return void p.o.error("O c\xf3digo deve ter 6 d\xedgitos");y(!0);try{let a=await f.Z.verify({code:e,backup_code:E?e:void 0,remember_device:x});if(a.success)p.o.success("Verifica\xe7\xe3o realizada com sucesso!"),null==t||t(a);else throw Error(a.message||"C\xf3digo inv\xe1lido")}catch(t){let e=F+1;C(e),e>=5?(S(!0),D(300),U(),p.o.error("Muitas tentativas incorretas. Tente novamente em 5 minutos.")):p.o.error("".concat(t.message,". ").concat(5-e," tentativas restantes.")),b(""),j("")}finally{y(!1)}},U=()=>{let e=setInterval(()=>{D(t=>t<=1?(clearInterval(e),S(!1),C(0),0):t-1)},1e3)},P=e=>{"Enter"!==e.key||N||A||R()};return(0,r.jsxs)(d.Zp,{className:"w-full max-w-md mx-auto",children:[(0,r.jsxs)(d.aR,{className:"text-center",children:[(0,r.jsx)("div",{className:"mx-auto mb-4 p-3 bg-blue-100 rounded-full w-fit",children:(0,r.jsx)(i.A,{className:"h-8 w-8 text-blue-600"})}),(0,r.jsx)(d.ZB,{children:"Verifica\xe7\xe3o 2FA"}),(0,r.jsxs)(d.BT,{children:[o&&(0,r.jsx)("span",{className:"block mb-2 font-medium",children:o}),E?"Digite um dos seus c\xf3digos de backup":"Digite o c\xf3digo do seu app autenticador"]})]}),(0,r.jsxs)(d.Wu,{className:"space-y-6",children:[A?(0,r.jsx)(g.Fc,{variant:"destructive",children:(0,r.jsx)(g.TN,{children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"font-medium mb-2",children:"Conta temporariamente bloqueada"}),(0,r.jsx)("div",{className:"text-2xl font-mono mb-2",children:(e=>{let t=Math.floor(e/60);return"".concat(t,":").concat((e%60).toString().padStart(2,"0"))})(T)}),(0,r.jsx)("div",{className:"text-sm",children:"Tente novamente ap\xf3s o tempo expirar"})]})})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(m.Label,{htmlFor:E?"backup-code":"verification-code",children:E?"C\xf3digo de Backup:":"C\xf3digo de Verifica\xe7\xe3o:"}),E?(0,r.jsx)(u.p,{id:"backup-code",value:w,onChange:e=>j(e.target.value.replace(/\s/g,"").toUpperCase()),onKeyPress:P,placeholder:"XXXXXXXX",className:"text-center text-lg font-mono tracking-wider",maxLength:8,disabled:N}):(0,r.jsx)(u.p,{id:"verification-code",value:v,onChange:e=>b(e.target.value.replace(/\D/g,"").slice(0,6)),onKeyPress:P,placeholder:"000000",className:"text-center text-lg font-mono tracking-widest",maxLength:6,disabled:N})]}),F>0&&(0,r.jsx)(g.Fc,{variant:F>=3?"destructive":"default",children:(0,r.jsx)(g.TN,{children:F>=3?"⚠️ ".concat(5-F," tentativas restantes antes do bloqueio"):"".concat(F," tentativa").concat(F>1?"s":""," incorreta").concat(F>1?"s":"")})}),(0,r.jsx)(c.$,{onClick:R,disabled:N||!E&&6!==v.length||E&&!w.trim(),className:"w-full",children:N?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Verificando..."]}):"Verificar"}),(0,r.jsx)(h.Separator,{}),(0,r.jsxs)("div",{className:"text-center space-y-2",children:[(0,r.jsx)(c.$,{variant:"ghost",onClick:()=>{k(!E),b(""),j(""),k(!1)},className:"text-sm",children:E?"Usar c\xf3digo do app autenticador":"Usar c\xf3digo de backup"}),!E&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"O c\xf3digo muda a cada 30 segundos"})]})]}),a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.Separator,{}),(0,r.jsxs)(c.$,{variant:"outline",onClick:a,className:"w-full",disabled:N,children:[(0,r.jsx)(l.A,{className:"h-4 w-4 mr-2"}),"Voltar ao Login"]})]})]})]})}var v=a(27737),b=a(1243),w=a(4236);function j(){return(0,r.jsx)(d.Zp,{className:"w-full max-w-md mx-auto",children:(0,r.jsxs)(d.Wu,{className:"p-6 space-y-4",children:[(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)(v.E,{className:"h-16 w-16 rounded-full mx-auto"}),(0,r.jsx)(v.E,{className:"h-6 w-48 mx-auto"}),(0,r.jsx)(v.E,{className:"h-4 w-64 mx-auto"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(v.E,{className:"h-4 w-32"}),(0,r.jsx)(v.E,{className:"h-12 w-full"}),(0,r.jsx)(v.E,{className:"h-10 w-full"})]})]})})}function N(){let e=(0,o.useRouter)(),t=(0,o.useSearchParams)(),{user:a,login:i}=(0,w.As)(),[n,l]=(0,s.useState)(!0),[c,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(null),p=t.get("email"),f=t.get("returnUrl")||"/dashboard",v=t.get("sessionToken");(0,s.useEffect)(()=>{if(!p||!v){h("Par\xe2metros de autentica\xe7\xe3o inv\xe1lidos"),setTimeout(()=>{e.push("/auth/login")},3e3);return}u(p),l(!1)},[p,v,e]);let N=async t=>{try{await i({sessionToken:v,twoFactorToken:t.token,rememberDevice:t.remember_device}),e.push(f)}catch(e){h(e.message||"Erro ao completar autentica\xe7\xe3o")}};return n?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:(0,r.jsx)(j,{})}):m?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:(0,r.jsx)(d.Zp,{className:"w-full max-w-md mx-auto",children:(0,r.jsxs)(d.Wu,{className:"p-6",children:[(0,r.jsxs)(g.Fc,{variant:"destructive",children:[(0,r.jsx)(b.A,{className:"h-4 w-4"}),(0,r.jsx)(g.TN,{children:m})]}),(0,r.jsx)("div",{className:"mt-4 text-center",children:(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Redirecionando para a p\xe1gina de login..."})})]})})}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"w-full max-w-md",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Verifica\xe7\xe3o 2FA"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Digite o c\xf3digo do seu app autenticador para continuar"})]}),(0,r.jsx)(x,{onVerified:N,onBack:()=>{e.push("/auth/login")},userEmail:c,rememberDevice:!0}),(0,r.jsx)("div",{className:"mt-6 text-center",children:(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Problemas com o acesso?"," ",(0,r.jsx)("a",{href:"/auth/recovery",className:"text-blue-600 hover:text-blue-700 underline",children:"Usar c\xf3digo de recupera\xe7\xe3o"})]})})]})})}},27737:(e,t,a)=>{"use strict";a.d(t,{E:()=>o});var r=a(95155),s=a(53999);function o(e){let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,s.cn)("animate-pulse rounded-md bg-muted",t),...a})}},29674:(e,t,a)=>{Promise.resolve().then(a.bind(a,4208))},31886:(e,t,a)=>{"use strict";a.d(t,{A:()=>i,O:()=>n});var r=a(23464),s=a(56671);let o=r.A.create({baseURL:"http://localhost:8000",timeout:1e4,headers:{"Content-Type":"application/json"}});o.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,e=>{let{response:t}=e;if((null==t?void 0:t.status)===401)localStorage.removeItem("token"),localStorage.removeItem("user"),s.o.error("Sess\xe3o expirada. Fa\xe7a login novamente."),window.location.href="/auth/login";else if((null==t?void 0:t.status)===403)s.o.error("Acesso negado.");else if((null==t?void 0:t.status)===404)s.o.error("Recurso n\xe3o encontrado.");else if((null==t?void 0:t.status)>=500)s.o.error("Erro interno do servidor. Tente novamente mais tarde.");else if("ECONNABORTED"===e.code)s.o.error("Tempo limite da requisi\xe7\xe3o excedido.");else{var a;s.o.error((null==t||null==(a=t.data)?void 0:a.message)||"Erro inesperado.")}return Promise.reject(e)});let i=o,n={get:async(e,t)=>(await o.get(e,{params:t})).data,post:async(e,t)=>(await o.post(e,t)).data,put:async(e,t)=>(await o.put(e,t)).data,delete:async e=>(await o.delete(e)).data,patch:async(e,t)=>(await o.patch(e,t)).data}},49026:(e,t,a)=>{"use strict";a.d(t,{Fc:()=>l,TN:()=>c});var r=a(95155),s=a(12115),o=a(74466),i=a(53999);let n=(0,o.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),l=s.forwardRef((e,t)=>{let{className:a,variant:s,...o}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:(0,i.cn)(n({variant:s}),a),...o})});l.displayName="Alert",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h5",{ref:t,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",a),...s})}).displayName="AlertTitle";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",a),...s})});c.displayName="AlertDescription"},76037:(e,t,a)=>{"use strict";a.d(t,{Separator:()=>n});var r=a(95155),s=a(12115),o=a(87489),i=a(53999);let n=s.forwardRef((e,t)=>{let{className:a,orientation:s="horizontal",decorative:n=!0,...l}=e;return(0,r.jsx)(o.b,{ref:t,decorative:n,orientation:s,className:(0,i.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",a),...l})});n.displayName=o.b.displayName},80722:(e,t,a)=>{"use strict";a.d(t,{F:()=>r.A});var r=a(31886)},82714:(e,t,a)=>{"use strict";a.d(t,{Label:()=>c});var r=a(95155),s=a(12115),o=a(40968),i=a(74466),n=a(53999);let l=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.b,{ref:t,className:(0,n.cn)(l(),a),...s})});c.displayName=o.b.displayName},88482:(e,t,a)=>{"use strict";a.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>l,Zp:()=>i,aR:()=>n});var r=a(95155),s=a(12115),o=a(53999);let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});i.displayName="Card";let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",a),...s})});n.displayName="CardHeader";let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h3",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});l.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("p",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",a),...s})});d.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter"},89852:(e,t,a)=>{"use strict";a.d(t,{p:()=>i});var r=a(95155),s=a(12115),o=a(53999);let i=s.forwardRef((e,t)=>{let{className:a,type:s,...i}=e;return(0,r.jsx)("input",{type:s,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...i})});i.displayName="Input"},95954:(e,t,a)=>{"use strict";a.d(t,{Z:()=>o});var r=a(80722);class s{async getConfig(){try{return(await r.F.get("".concat(this.baseUrl,"/config"))).data}catch(r){var e,t,a;if((null==(e=r.response)?void 0:e.status)===404)return null;throw Error((null==(a=r.response)||null==(t=a.data)?void 0:t.message)||"Erro ao obter configura\xe7\xe3o 2FA")}}async setupTwoFactor(e){try{return(await r.F.post("".concat(this.baseUrl,"/setup"),e)).data}catch(e){var t,a;throw Error((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Erro ao configurar 2FA")}}async confirmSetup(e){try{return(await r.F.post("".concat(this.baseUrl,"/confirm-setup"),{code:e})).data}catch(e){var t,a;throw Error((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"C\xf3digo inv\xe1lido")}}async verifyTwoFactor(e){try{return(await r.F.post("".concat(this.baseUrl,"/verify"),e)).data}catch(e){var t,a;throw Error((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"C\xf3digo inv\xe1lido")}}async disableTwoFactor(e){try{await r.F.post("".concat(this.baseUrl,"/disable"),e)}catch(e){var t,a;throw Error((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Erro ao desabilitar 2FA")}}async regenerateBackupCodes(){try{return(await r.F.post("".concat(this.baseUrl,"/regenerate-backup-codes"))).data.backup_codes}catch(a){var e,t;throw Error((null==(t=a.response)||null==(e=t.data)?void 0:e.message)||"Erro ao regenerar c\xf3digos de backup")}}async getTrustedDevices(){try{return(await r.F.get("".concat(this.baseUrl,"/trusted-devices"))).data}catch(a){var e,t;throw Error((null==(t=a.response)||null==(e=t.data)?void 0:e.message)||"Erro ao obter dispositivos confi\xe1veis")}}async removeTrustedDevice(e){try{await r.F.delete("".concat(this.baseUrl,"/trusted-devices/").concat(e))}catch(e){var t,a;throw Error((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Erro ao remover dispositivo")}}async getAuthLogs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;try{return(await r.F.get("".concat(this.baseUrl,"/auth-logs"),{params:{limit:e}})).data}catch(e){var t,a;throw Error((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Erro ao obter logs de autentica\xe7\xe3o")}}async getStats(){try{return(await r.F.get("".concat(this.baseUrl,"/stats"))).data}catch(a){var e,t;throw Error((null==(t=a.response)||null==(e=t.data)?void 0:e.message)||"Erro ao obter estat\xedsticas")}}async checkTrustedDevice(e){try{return(await r.F.post("".concat(this.baseUrl,"/check-trusted-device"),{device_fingerprint:e})).data.is_trusted}catch(e){return!1}}generateDeviceFingerprint(){let e=document.createElement("canvas"),t=e.getContext("2d");t&&(t.textBaseline="top",t.font="14px Arial",t.fillText("Device fingerprint",2,2));let a=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),e.toDataURL(),navigator.hardwareConcurrency||0,navigator.deviceMemory||0].join("|"),r=0;for(let e=0;e<a.length;e++)r=(r<<5)-r+a.charCodeAt(e),r&=r;return Math.abs(r).toString(36)}getCurrentDeviceInfo(){let e=navigator.userAgent,t="Dispositivo Desconhecido";return t=/Mobile|Android|iPhone|iPad/.test(e)?/iPhone/.test(e)?"iPhone":/iPad/.test(e)?"iPad":/Android/.test(e)?"Android":"Mobile":/Windows/.test(e)?"Windows PC":/Mac/.test(e)?"Mac":/Linux/.test(e)?"Linux":"Desktop",/Chrome/.test(e)?t+=" - Chrome":/Firefox/.test(e)?t+=" - Firefox":/Safari/.test(e)?t+=" - Safari":/Edge/.test(e)&&(t+=" - Edge"),{name:t,fingerprint:this.generateDeviceFingerprint(),userAgent:e}}constructor(){this.baseUrl="/auth/2fa"}}let o=new s}},e=>{e.O(0,[3455,6671,5954,3464,2354,1686,7469,8441,5964,7358],()=>e(e.s=29674)),_N_E=e.O()}]);