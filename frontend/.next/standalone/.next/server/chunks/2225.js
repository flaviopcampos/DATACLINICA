"use strict";exports.id=2225,exports.ids=[2225],exports.modules={3018:(a,b,c)=>{c.d(b,{Fc:()=>i,TN:()=>j});var d=c(60687),e=c(43210),f=c(24224),g=c(96241);let h=(0,f.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=e.forwardRef(({className:a,variant:b,...c},e)=>(0,d.jsx)("div",{ref:e,role:"alert",className:(0,g.cn)(h({variant:b}),a),...c}));i.displayName="Alert",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("h5",{ref:c,className:(0,g.cn)("mb-1 font-medium leading-none tracking-tight",a),...b})).displayName="AlertTitle";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,g.cn)("text-sm [&_p]:leading-relaxed",a),...b}));j.displayName="AlertDescription"},3560:(a,b,c)=>{c.d(b,{Z:()=>f});var d=c(64298);class e{async getConfig(){try{return(await d.F.get(`${this.baseUrl}/config`)).data}catch(a){if(a.response?.status===404)return null;throw Error(a.response?.data?.message||"Erro ao obter configura\xe7\xe3o 2FA")}}async setupTwoFactor(a){try{return(await d.F.post(`${this.baseUrl}/setup`,a)).data}catch(a){throw Error(a.response?.data?.message||"Erro ao configurar 2FA")}}async confirmSetup(a){try{return(await d.F.post(`${this.baseUrl}/confirm-setup`,{code:a})).data}catch(a){throw Error(a.response?.data?.message||"C\xf3digo inv\xe1lido")}}async verifyTwoFactor(a){try{return(await d.F.post(`${this.baseUrl}/verify`,a)).data}catch(a){throw Error(a.response?.data?.message||"C\xf3digo inv\xe1lido")}}async disableTwoFactor(a){try{await d.F.post(`${this.baseUrl}/disable`,a)}catch(a){throw Error(a.response?.data?.message||"Erro ao desabilitar 2FA")}}async regenerateBackupCodes(){try{return(await d.F.post(`${this.baseUrl}/regenerate-backup-codes`)).data.backup_codes}catch(a){throw Error(a.response?.data?.message||"Erro ao regenerar c\xf3digos de backup")}}async getTrustedDevices(){try{return(await d.F.get(`${this.baseUrl}/trusted-devices`)).data}catch(a){throw Error(a.response?.data?.message||"Erro ao obter dispositivos confi\xe1veis")}}async removeTrustedDevice(a){try{await d.F.delete(`${this.baseUrl}/trusted-devices/${a}`)}catch(a){throw Error(a.response?.data?.message||"Erro ao remover dispositivo")}}async getAuthLogs(a=50){try{return(await d.F.get(`${this.baseUrl}/auth-logs`,{params:{limit:a}})).data}catch(a){throw Error(a.response?.data?.message||"Erro ao obter logs de autentica\xe7\xe3o")}}async getStats(){try{return(await d.F.get(`${this.baseUrl}/stats`)).data}catch(a){throw Error(a.response?.data?.message||"Erro ao obter estat\xedsticas")}}async checkTrustedDevice(a){try{return(await d.F.post(`${this.baseUrl}/check-trusted-device`,{device_fingerprint:a})).data.is_trusted}catch(a){return!1}}generateDeviceFingerprint(){let a=document.createElement("canvas"),b=a.getContext("2d");b&&(b.textBaseline="top",b.font="14px Arial",b.fillText("Device fingerprint",2,2));let c=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),a.toDataURL(),navigator.hardwareConcurrency||0,navigator.deviceMemory||0].join("|"),d=0;for(let a=0;a<c.length;a++)d=(d<<5)-d+c.charCodeAt(a),d&=d;return Math.abs(d).toString(36)}getCurrentDeviceInfo(){let a=navigator.userAgent,b="Dispositivo Desconhecido";return b=/Mobile|Android|iPhone|iPad/.test(a)?/iPhone/.test(a)?"iPhone":/iPad/.test(a)?"iPad":/Android/.test(a)?"Android":"Mobile":/Windows/.test(a)?"Windows PC":/Mac/.test(a)?"Mac":/Linux/.test(a)?"Linux":"Desktop",/Chrome/.test(a)?b+=" - Chrome":/Firefox/.test(a)?b+=" - Firefox":/Safari/.test(a)?b+=" - Safari":/Edge/.test(a)&&(b+=" - Edge"),{name:b,fingerprint:this.generateDeviceFingerprint(),userAgent:a}}constructor(){this.baseUrl="/auth/2fa"}}let f=new e},39390:(a,b,c)=>{c.d(b,{Label:()=>j});var d=c(60687),e=c(43210),f=c(78148),g=c(24224),h=c(96241);let i=(0,g.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.b,{ref:c,className:(0,h.cn)(i(),a),...b}));j.displayName=f.b.displayName},55192:(a,b,c)=>{c.d(b,{BT:()=>j,Wu:()=>k,ZB:()=>i,Zp:()=>g,aR:()=>h});var d=c(60687),e=c(43210),f=c(96241);let g=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...b}));g.displayName="Card";let h=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex flex-col space-y-1.5 p-6",a),...b}));h.displayName="CardHeader";let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("h3",{ref:c,className:(0,f.cn)("text-2xl font-semibold leading-none tracking-tight",a),...b}));i.displayName="CardTitle";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("p",{ref:c,className:(0,f.cn)("text-sm text-muted-foreground",a),...b}));j.displayName="CardDescription";let k=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("p-6 pt-0",a),...b}));k.displayName="CardContent",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex items-center p-6 pt-0",a),...b})).displayName="CardFooter"},72225:(a,b,c)=>{c.d(b,{l:()=>w});var d=c(60687),e=c(43210),f=c(46211),g=c(99891),h=c(17581),i=c(12597),j=c(13861),k=c(70615),l=c(31158),m=c(24934),n=c(55192),o=c(68988),p=c(39390),q=c(3018),r=c(59821),s=c(78377),t=c(52581),u=c(81198),v=c(3560);function w({onComplete:a,onCancel:b}){let{setupTwoFactor:c}=(0,u.NL)(),[w,x]=(0,e.useState)("method"),[y,z]=(0,e.useState)("totp"),[A,B]=(0,e.useState)(null),[C,D]=(0,e.useState)(""),[E,F]=(0,e.useState)(!1),[G,H]=(0,e.useState)(!1),[I,J]=(0,e.useState)(!1),K=async a=>{z(a),F(!0);try{let b=await c({method:a});B(b),x("setup")}catch(a){}finally{F(!1)}},L=async()=>{if(!C.trim())return void t.o.error("Digite o c\xf3digo de verifica\xe7\xe3o");F(!0);try{await v.Z.confirmSetup(C),x("backup"),t.o.success("2FA configurado com sucesso!")}catch(a){t.o.error(a.message)}finally{F(!1)}},M=(a,b)=>{navigator.clipboard.writeText(a),t.o.success(`${b} copiado para a \xe1rea de transfer\xeancia`)};return"method"===w?(0,d.jsxs)(n.Zp,{className:"w-full max-w-md mx-auto",children:[(0,d.jsxs)(n.aR,{className:"text-center",children:[(0,d.jsx)("div",{className:"mx-auto mb-4 p-3 bg-blue-100 rounded-full w-fit",children:(0,d.jsx)(g.A,{className:"h-8 w-8 text-blue-600"})}),(0,d.jsx)(n.ZB,{children:"Configurar Autentica\xe7\xe3o 2FA"}),(0,d.jsx)(n.BT,{children:"Adicione uma camada extra de seguran\xe7a \xe0 sua conta"})]}),(0,d.jsxs)(n.Wu,{className:"space-y-4",children:[(0,d.jsx)("div",{className:"space-y-3",children:(0,d.jsxs)(m.$,{variant:"outline",className:"w-full h-auto p-4 justify-start",onClick:()=>K("totp"),disabled:E,children:[(0,d.jsx)(h.A,{className:"h-5 w-5 mr-3"}),(0,d.jsxs)("div",{className:"text-left",children:[(0,d.jsx)("div",{className:"font-medium",children:"App Autenticador"}),(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:"Google Authenticator, Authy, etc."})]})]})}),(0,d.jsx)("div",{className:"flex gap-2",children:(0,d.jsx)(m.$,{variant:"outline",onClick:b,className:"flex-1",children:"Cancelar"})})]})]}):"setup"===w&&A?(0,d.jsxs)(n.Zp,{className:"w-full max-w-lg mx-auto",children:[(0,d.jsxs)(n.aR,{className:"text-center",children:[(0,d.jsx)(n.ZB,{children:"Configurar App Autenticador"}),(0,d.jsx)(n.BT,{children:"Escaneie o QR Code ou digite a chave manualmente"})]}),(0,d.jsxs)(n.Wu,{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,d.jsx)("div",{className:"p-4 bg-white rounded-lg border",children:(0,d.jsx)(f.h,{value:A.qr_code_url,size:200,level:"M",includeMargin:!0})}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"Escaneie este c\xf3digo com seu app autenticador"})]}),(0,d.jsx)(s.Separator,{}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(p.Label,{children:"Ou digite a chave manualmente:"}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)(o.p,{value:G?A.manual_entry_key:"••••••••••••••••",readOnly:!0,className:"font-mono text-sm"}),(0,d.jsx)(m.$,{variant:"outline",size:"icon",onClick:()=>H(!G),children:G?(0,d.jsx)(i.A,{className:"h-4 w-4"}):(0,d.jsx)(j.A,{className:"h-4 w-4"})}),(0,d.jsx)(m.$,{variant:"outline",size:"icon",onClick:()=>M(A.manual_entry_key,"Chave"),children:(0,d.jsx)(k.A,{className:"h-4 w-4"})})]})]}),(0,d.jsx)(s.Separator,{}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(p.Label,{htmlFor:"verification-code",children:"Digite o c\xf3digo do seu app autenticador:"}),(0,d.jsx)(o.p,{id:"verification-code",value:C,onChange:a=>D(a.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"text-center text-lg font-mono tracking-widest",maxLength:6})]}),(0,d.jsx)(q.Fc,{children:(0,d.jsx)(q.TN,{children:"O c\xf3digo muda a cada 30 segundos. Digite o c\xf3digo atual exibido no seu app."})})]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)(m.$,{variant:"outline",onClick:()=>x("method"),className:"flex-1",children:"Voltar"}),(0,d.jsx)(m.$,{onClick:L,disabled:E||6!==C.length,className:"flex-1",children:E?"Verificando...":"Verificar"})]})]})]}):"backup"===w&&A?(0,d.jsxs)(n.Zp,{className:"w-full max-w-lg mx-auto",children:[(0,d.jsxs)(n.aR,{className:"text-center",children:[(0,d.jsx)(n.ZB,{className:"text-green-600",children:"2FA Configurado!"}),(0,d.jsx)(n.BT,{children:"Salve seus c\xf3digos de backup em local seguro"})]}),(0,d.jsxs)(n.Wu,{className:"space-y-6",children:[(0,d.jsx)(q.Fc,{children:(0,d.jsxs)(q.TN,{children:[(0,d.jsx)("strong",{children:"Importante:"})," Estes c\xf3digos de backup podem ser usados para acessar sua conta se voc\xea perder acesso ao seu app autenticador. Cada c\xf3digo pode ser usado apenas uma vez."]})}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)(p.Label,{children:"C\xf3digos de Backup:"}),(0,d.jsxs)(r.E,{variant:"secondary",children:[A.backup_codes.length," c\xf3digos"]})]}),(0,d.jsx)("div",{className:"grid grid-cols-2 gap-2 p-4 bg-muted rounded-lg font-mono text-sm",children:A.backup_codes.map((a,b)=>(0,d.jsxs)("div",{className:"flex items-center justify-between p-2 bg-background rounded border",children:[(0,d.jsx)("span",{children:a}),(0,d.jsx)(m.$,{variant:"ghost",size:"sm",onClick:()=>M(a,`C\xf3digo ${b+1}`),children:(0,d.jsx)(k.A,{className:"h-3 w-3"})})]},b))})]}),(0,d.jsxs)(m.$,{variant:"outline",onClick:()=>{if(!A?.backup_codes)return;let a=new Blob([["C\xd3DIGOS DE BACKUP - DATACLINICA 2FA","=====================================","","IMPORTANTE: Guarde estes c\xf3digos em local seguro!","Cada c\xf3digo pode ser usado apenas uma vez.","",...A.backup_codes.map((a,b)=>`${b+1}. ${a}`),"",`Gerado em: ${new Date().toLocaleString("pt-BR")}`].join("\n")],{type:"text/plain"}),b=URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`dataclinica-2fa-backup-codes-${Date.now()}.txt`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(b),J(!0),t.o.success("C\xf3digos de backup baixados com sucesso!")},className:"w-full",children:[(0,d.jsx)(l.A,{className:"h-4 w-4 mr-2"}),"Baixar C\xf3digos de Backup"]}),I&&(0,d.jsx)(q.Fc,{children:(0,d.jsx)(q.TN,{className:"text-green-600",children:"✓ C\xf3digos de backup salvos com sucesso!"})}),(0,d.jsx)(m.$,{onClick:()=>{if(!I)return void t.o.error("Por favor, salve os c\xf3digos de backup antes de continuar");a?.()},disabled:!I,className:"w-full",children:"Concluir Configura\xe7\xe3o"})]})]}):null}},78377:(a,b,c)=>{c.d(b,{Separator:()=>h});var d=c(60687),e=c(43210),f=c(62369),g=c(96241);let h=e.forwardRef(({className:a,orientation:b="horizontal",decorative:c=!0,...e},h)=>(0,d.jsx)(f.b,{ref:h,decorative:c,orientation:b,className:(0,g.cn)("shrink-0 bg-border","horizontal"===b?"h-[1px] w-full":"h-full w-[1px]",a),...e}));h.displayName=f.b.displayName},81198:(a,b,c)=>{c.d(b,{NL:()=>k});var d=c(43210),e=c(31074),f=c(51423),g=c(54050),h=c(52581),i=c(3560);let j={config:["2fa","config"],trustedDevices:["2fa","trusted-devices"],authLogs:["2fa","auth-logs"],stats:["2fa","stats"]};function k(){let a=(0,e.jE)(),[b,c]=(0,d.useState)(null),{data:k,isLoading:l,error:m}=(0,f.I)({queryKey:j.config,queryFn:()=>i.Z.getConfig(),retry:!1}),{data:n=[],isLoading:o}=(0,f.I)({queryKey:j.trustedDevices,queryFn:()=>i.Z.getTrustedDevices(),enabled:!!k&&k.status===TwoFactorStatus.ENABLED}),{data:p=[],isLoading:q}=(0,f.I)({queryKey:j.authLogs,queryFn:()=>i.Z.getAuthLogs(50),enabled:!!k&&k.status===TwoFactorStatus.ENABLED}),{data:r,isLoading:s}=(0,f.I)({queryKey:j.stats,queryFn:()=>i.Z.getStats(),enabled:!!k&&k.status===TwoFactorStatus.ENABLED}),t=(0,g.n)({mutationFn:a=>i.Z.setupTwoFactor(a),onSuccess:()=>{h.o.success("2FA configurado com sucesso!"),a.invalidateQueries({queryKey:j.config})},onError:a=>{c(a.message),h.o.error(a.message)}}),u=(0,g.n)({mutationFn:a=>i.Z.verifyTwoFactor(a),onError:a=>{c(a.message),h.o.error(a.message)}}),v=(0,g.n)({mutationFn:a=>i.Z.disableTwoFactor(a),onSuccess:()=>{h.o.success("2FA desabilitado com sucesso!"),a.invalidateQueries({queryKey:j.config}),a.removeQueries({queryKey:j.trustedDevices}),a.removeQueries({queryKey:j.authLogs}),a.removeQueries({queryKey:j.stats})},onError:a=>{c(a.message),h.o.error(a.message)}}),w=(0,g.n)({mutationFn:()=>i.Z.regenerateBackupCodes(),onSuccess:()=>{h.o.success("C\xf3digos de backup regenerados!"),a.invalidateQueries({queryKey:j.config})},onError:a=>{c(a.message),h.o.error(a.message)}}),x=(0,g.n)({mutationFn:a=>i.Z.removeTrustedDevice(a),onSuccess:()=>{h.o.success("Dispositivo removido com sucesso!"),a.invalidateQueries({queryKey:j.trustedDevices})},onError:a=>{c(a.message),h.o.error(a.message)}}),y=(0,d.useCallback)(async a=>(c(null),t.mutateAsync(a)),[t]),z=(0,d.useCallback)(async a=>(c(null),u.mutateAsync(a)),[u]),A=(0,d.useCallback)(async a=>(c(null),v.mutateAsync(a)),[v]),B=(0,d.useCallback)(async()=>(c(null),w.mutateAsync()),[w]);return{config:k||null,trustedDevices:n,authLogs:p,stats:r||null,isLoading:l||o||q||s,error:b,setupTwoFactor:y,verifyTwoFactor:z,disableTwoFactor:A,regenerateBackupCodes:B,removeTrustedDevice:(0,d.useCallback)(async a=>(c(null),x.mutateAsync(a)),[x]),refreshConfig:(0,d.useCallback)(async()=>{await a.invalidateQueries({queryKey:j.config}),await a.invalidateQueries({queryKey:j.trustedDevices}),await a.invalidateQueries({queryKey:j.authLogs}),await a.invalidateQueries({queryKey:j.stats})},[a])}}}};