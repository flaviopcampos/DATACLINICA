"use strict";exports.id=1147,exports.ids=[1147],exports.modules={39954:(a,b,c)=>{c.d(b,{Sk:()=>i,VU:()=>j,vt:()=>h,wE:()=>k});var d=c(51423),e=(c(31074),c(54050),c(52581),c(35371));let f={all:["permissions"],lists:()=>[...f.all,"list"],details:()=>[...f.all,"detail"],detail:a=>[...f.details(),a],user:a=>[...f.all,"user",a],matrix:()=>[...f.all,"matrix"],check:(a,b,c)=>[...f.all,"check",a,b,c]},g={all:["modules"],lists:()=>[...g.all,"list"],details:()=>[...g.all,"detail"],detail:a=>[...g.details(),a]};function h(){return(0,d.I)({queryKey:g.lists(),queryFn:()=>e._i.getModules(),staleTime:9e5,gcTime:36e5})}function i(){return(0,d.I)({queryKey:f.lists(),queryFn:()=>e.ps.getPermissions(),staleTime:6e5,gcTime:18e5})}function j(a,b=!0){return(0,d.I)({queryKey:f.user(a),queryFn:()=>e.ps.getUserPermissions(a),enabled:b&&!!a,staleTime:3e5,gcTime:9e5})}function k(){return(0,d.I)({queryKey:f.matrix(),queryFn:()=>e.ps.getPermissionMatrix(),staleTime:6e5,gcTime:18e5})}},40070:(a,b,c)=>{c.d(b,{N:()=>O});var d=c(60687),e=c(43210),f=c(91926),g=c(24934);c(59821);var h=c(55192),i=c(93437),j=c(89e3),k=c(68988),l=c(39390),m=c(63974),n=c(96752),o=c(95033),p=c(96474),q=c(13861),r=c(63143),s=c(88233),t=c(84027),u=c(41312),v=c(40228),w=c(10022),x=c(19080),y=c(53411),z=c(99891),A=c(13943),B=c(8819),C=c(31158),D=c(99270),E=c(13964),F=c(11860),G=c(52581),H=c(39954),I=c(17223),J=c(96241);let K=["create","read","update","delete","manage"],L={create:"Criar",read:"Visualizar",update:"Editar",delete:"Excluir",manage:"Gerenciar"},M={create:p.A,read:q.A,update:r.A,delete:s.A,manage:t.A},N={[f.Rx.USERS]:u.A,[f.Rx.PATIENTS]:u.A,[f.Rx.APPOINTMENTS]:v.A,[f.Rx.PRESCRIPTIONS]:w.A,[f.Rx.INVENTORY]:x.A,[f.Rx.REPORTS]:y.A};function O({user:a,role:b,mode:c="overview",editable:p=!1,showActions:q=!0,className:r}){let[s,t]=(0,e.useState)(""),[u,v]=(0,e.useState)("all"),[w,x]=(0,e.useState)(b||"all"),[y,O]=(0,e.useState)({}),[P,Q]=(0,e.useState)(!1),[R,S]=(0,e.useState)(!1),{data:T,isLoading:U}=(0,H.vt)(),{data:V,isLoading:W}=(0,H.Sk)(),{data:X,isLoading:Y}=(0,H.VU)(a?.id,{enabled:!!a&&"user"===c}),{data:Z,isLoading:$}=(0,H.wE)({enabled:"overview"===c}),_=(0,I.t3)(),aa=(0,e.useMemo)(()=>T?T.filter(a=>{let b=a.name.toLowerCase().includes(s.toLowerCase())||a.description?.toLowerCase().includes(s.toLowerCase()),c="all"===u||a.resource_type===u;return b&&c}):[],[T,s,u]),ab=(a,b)=>`${a}:${b}`,ac=(a,b)=>{let d=ab(a,b);return"user"===c&&X?X.some(c=>c.resource_type===a&&c.action===b):y.hasOwnProperty(d)?y[d]:w===f.QY.ADMIN},ad=async()=>{if(!w||"all"===w)return void G.o.error("Selecione um perfil para salvar as altera\xe7\xf5es");try{let a=Object.entries(y).map(([a,b])=>{let[c,d]=a.split(":");return{resource_type:c,action:d,enabled:b}});await _.mutateAsync({role:w,permissions:a}),O({}),Q(!1),S(!1),G.o.success("Permiss\xf5es atualizadas com sucesso!")}catch(a){G.o.error("Erro ao atualizar permiss\xf5es")}},ae=a=>N[a]||z.A;return U||W||Y||$?(0,d.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,d.jsx)(j.LoadingSpinner,{size:"lg"})}):(0,d.jsxs)("div",{className:(0,J.cn)("space-y-6",r),children:[(0,d.jsxs)("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-2xl font-bold tracking-tight",children:"Matriz de Permiss\xf5es"}),(0,d.jsx)("p",{className:"text-muted-foreground",children:"user"===c&&a?`Permiss\xf5es do usu\xe1rio ${a.full_name}`:"role"===c&&"all"!==w?`Permiss\xf5es do perfil ${w}`:"Vis\xe3o geral das permiss\xf5es do sistema"})]}),q&&(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[P&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(g.$,{variant:"outline",size:"sm",onClick:()=>{O({}),Q(!1)},children:[(0,d.jsx)(A.A,{className:"mr-2 h-4 w-4"}),"Resetar"]}),(0,d.jsxs)(g.$,{size:"sm",onClick:()=>S(!0),children:[(0,d.jsx)(B.A,{className:"mr-2 h-4 w-4"}),"Salvar Altera\xe7\xf5es"]})]}),(0,d.jsxs)(g.$,{variant:"outline",size:"sm",children:[(0,d.jsx)(C.A,{className:"mr-2 h-4 w-4"}),"Exportar"]})]})]}),(0,d.jsx)(h.Zp,{children:(0,d.jsx)(h.Wu,{className:"pt-6",children:(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(l.Label,{htmlFor:"search",children:"Buscar Recursos"}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(D.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,d.jsx)(k.p,{id:"search",placeholder:"Buscar por nome ou descri\xe7\xe3o...",value:s,onChange:a=>t(a.target.value),className:"pl-10"})]})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(l.Label,{htmlFor:"resource-filter",children:"Filtrar por Recurso"}),(0,d.jsxs)(m.l6,{value:u,onValueChange:v,children:[(0,d.jsx)(m.bq,{children:(0,d.jsx)(m.yv,{placeholder:"Todos os recursos"})}),(0,d.jsxs)(m.gC,{children:[(0,d.jsx)(m.eb,{value:"all",children:"Todos os recursos"}),Object.values(f.Rx).map(a=>{let b=ae(a);return(0,d.jsx)(m.eb,{value:a,children:(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(b,{className:"h-4 w-4"}),(0,d.jsx)("span",{className:"capitalize",children:a})]})},a)})]})]})]}),"user"!==c&&(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(l.Label,{htmlFor:"role-filter",children:"Filtrar por Perfil"}),(0,d.jsxs)(m.l6,{value:w,onValueChange:x,children:[(0,d.jsx)(m.bq,{children:(0,d.jsx)(m.yv,{placeholder:"Todos os perfis"})}),(0,d.jsxs)(m.gC,{children:[(0,d.jsx)(m.eb,{value:"all",children:"Todos os perfis"}),Object.values(f.QY).map(a=>(0,d.jsx)(m.eb,{value:a,children:a},a))]})]})]})]})})}),(0,d.jsxs)(h.Zp,{children:[(0,d.jsxs)(h.aR,{children:[(0,d.jsxs)(h.ZB,{className:"flex items-center",children:[(0,d.jsx)(z.A,{className:"mr-2 h-5 w-5"}),"Matriz de Permiss\xf5es"]}),(0,d.jsx)(h.BT,{children:p?"Clique nas c\xe9lulas para alterar as permiss\xf5es":"Visualiza\xe7\xe3o das permiss\xf5es atuais"})]}),(0,d.jsxs)(h.Wu,{children:[(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)(n.XI,{children:[(0,d.jsx)(n.A0,{children:(0,d.jsxs)(n.Hj,{children:[(0,d.jsx)(n.nd,{className:"w-[200px]",children:"Recurso"}),K.map(a=>{let b=M[a];return(0,d.jsx)(n.nd,{className:"text-center",children:(0,d.jsxs)("div",{className:"flex items-center justify-center space-x-1",children:[(0,d.jsx)(b,{className:"h-4 w-4"}),(0,d.jsx)("span",{children:L[a]})]})},a)})]})}),(0,d.jsx)(n.BF,{children:aa.map(a=>{let b=ae(a.resource_type);return(0,d.jsxs)(n.Hj,{children:[(0,d.jsx)(n.nA,{children:(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)(b,{className:"h-5 w-5 text-muted-foreground"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"font-medium",children:a.name}),a.description&&(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:a.description})]})]})}),K.map(b=>{let c=ac(a.resource_type,b),e=p&&"all"!==w;return(0,d.jsx)(n.nA,{className:"text-center",children:(0,d.jsx)("div",{className:"flex justify-center",children:e?(0,d.jsx)(i.S,{checked:c,onCheckedChange:()=>((a,b)=>{if(!p)return;let c=ab(a,b),d=ac(a,b);O(a=>({...a,[c]:!d})),Q(!0)})(a.resource_type,b),className:"h-5 w-5"}):(0,d.jsx)("div",{className:(0,J.cn)("flex items-center justify-center w-5 h-5 rounded",c?"bg-green-100 text-green-600":"bg-gray-100 text-gray-400"),children:c?(0,d.jsx)(E.A,{className:"h-3 w-3"}):(0,d.jsx)(F.A,{className:"h-3 w-3"})})})},b)})]},a.id)})})]})}),0===aa.length&&(0,d.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,d.jsx)(z.A,{className:"mx-auto h-12 w-12 mb-4 opacity-50"}),(0,d.jsx)("p",{children:"Nenhum recurso encontrado"}),(0,d.jsx)("p",{className:"text-sm",children:"Tente ajustar os filtros de busca"})]})]})]}),(0,d.jsxs)(h.Zp,{children:[(0,d.jsx)(h.aR,{children:(0,d.jsx)(h.ZB,{className:"text-sm",children:"Legenda"})}),(0,d.jsx)(h.Wu,{children:(0,d.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:K.map(a=>{let b=M[a];return(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(b,{className:(0,J.cn)("h-4 w-4",{create:"text-green-600",read:"text-blue-600",update:"text-yellow-600",delete:"text-red-600",manage:"text-purple-600"}[a])}),(0,d.jsx)("span",{className:"text-sm",children:L[a]})]},a)})})})]}),(0,d.jsx)(o.Lt,{open:R,onOpenChange:S,children:(0,d.jsxs)(o.EO,{children:[(0,d.jsxs)(o.wd,{children:[(0,d.jsxs)(o.r7,{className:"flex items-center",children:[(0,d.jsx)(B.A,{className:"mr-2 h-5 w-5"}),"Salvar Altera\xe7\xf5es"]}),(0,d.jsxs)(o.$v,{children:["Tem certeza que deseja salvar as altera\xe7\xf5es nas permiss\xf5es do perfil ",(0,d.jsx)("strong",{children:w}),"?",(0,d.jsx)("br",{}),(0,d.jsx)("br",{}),"Esta a\xe7\xe3o ir\xe1 afetar todos os usu\xe1rios com este perfil."]})]}),(0,d.jsxs)(o.ck,{children:[(0,d.jsx)(o.Zr,{children:"Cancelar"}),(0,d.jsxs)(o.Rx,{onClick:ad,children:[_.isPending?(0,d.jsx)(j.LoadingSpinner,{size:"sm",className:"mr-2"}):null,"Salvar Altera\xe7\xf5es"]})]})]})})]})}},85910:(a,b,c)=>{c.d(b,{Tabs:()=>h,TabsContent:()=>k,TabsList:()=>i,TabsTrigger:()=>j});var d=c(60687),e=c(43210),f=c(55146),g=c(96241);let h=f.bL,i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.B8,{ref:c,className:(0,g.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...b}));i.displayName=f.B8.displayName;let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.l9,{ref:c,className:(0,g.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...b}));j.displayName=f.l9.displayName;let k=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.UC,{ref:c,className:(0,g.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...b}));k.displayName=f.UC.displayName},96752:(a,b,c)=>{c.d(b,{A0:()=>h,BF:()=>i,Hj:()=>j,XI:()=>g,nA:()=>l,nd:()=>k});var d=c(60687),e=c(43210),f=c(96241);let g=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{className:"relative w-full overflow-auto",children:(0,d.jsx)("table",{ref:c,className:(0,f.cn)("w-full caption-bottom text-sm",a),...b})}));g.displayName="Table";let h=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("thead",{ref:c,className:(0,f.cn)("[&_tr]:border-b",a),...b}));h.displayName="TableHeader";let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("tbody",{ref:c,className:(0,f.cn)("[&_tr:last-child]:border-0",a),...b}));i.displayName="TableBody",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("tfoot",{ref:c,className:(0,f.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...b})).displayName="TableFooter";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("tr",{ref:c,className:(0,f.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...b}));j.displayName="TableRow";let k=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("th",{ref:c,className:(0,f.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...b}));k.displayName="TableHead";let l=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("td",{ref:c,className:(0,f.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...b}));l.displayName="TableCell",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("caption",{ref:c,className:(0,f.cn)("mt-4 text-sm text-muted-foreground",a),...b})).displayName="TableCaption"}};