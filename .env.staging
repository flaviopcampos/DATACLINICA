# Configurações de Staging/Homologação - DataClinica
# Ambiente intermediário para testes antes da produção

# =============================================================================
# CONFIGURAÇÕES BÁSICAS
# =============================================================================
ENVIRONMENT=staging
DEBUG=false
LOG_LEVEL=DEBUG
VERSION=1.0.0-staging

# =============================================================================
# BANCO DE DADOS (RDS STAGING)
# =============================================================================
# Usar instância menor para staging
DATABASE_URL=postgresql://dataclinica_staging:staging_password@dataclinica-staging.cluster-xyz.us-east-1.rds.amazonaws.com:5432/dataclinica_staging
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=15
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_ECHO=true  # Habilitar logs SQL para debug

# =============================================================================
# REDIS (ELASTICACHE STAGING)
# =============================================================================
REDIS_URL=redis://dataclinica-staging.cache.amazonaws.com:6379/0
CACHE_TTL=1800  # 30 minutos
SESSION_TTL=43200  # 12 horas

# =============================================================================
# SEGURANÇA E AUTENTICAÇÃO
# =============================================================================
# Chaves de staging (diferentes da produção)
SECRET_KEY=staging-secret-key-dataclinica-2024
JWT_SECRET_KEY=staging-jwt-secret-key-dataclinica-2024
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=60
REFRESH_TOKEN_EXPIRE_DAYS=7
PASSWORD_MIN_LENGTH=6  # Mais flexível para testes
PASSWORD_REQUIRE_SPECIAL=false

# =============================================================================
# CORS (MAIS PERMISSIVO PARA TESTES)
# =============================================================================
CORS_ORIGINS=https://staging.dataclinica.com,https://staging-app.dataclinica.com,http://localhost:3000
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS,PATCH
CORS_ALLOW_HEADERS=*

# =============================================================================
# EMAIL E NOTIFICAÇÕES (SANDBOX)
# =============================================================================
# Usar Mailhog ou serviço de teste
SMTP_HOST=mailhog
SMTP_PORT=1025
SMTP_USER=
SMTP_PASSWORD=
SMTP_TLS=false
EMAIL_FROM=staging@dataclinica.com
EMAIL_FROM_NAME=DataClinica Staging

# Notificações por email
EMAIL_ADMIN=admin-staging@dataclinica.com
EMAIL_SUPPORT=suporte-staging@dataclinica.com
EMAIL_NOTIFICATIONS_ENABLED=true

# =============================================================================
# AWS CONFIGURAÇÕES (STAGING)
# =============================================================================
AWS_ACCESS_KEY_ID=STAGING_AWS_ACCESS_KEY
AWS_SECRET_ACCESS_KEY=STAGING_AWS_SECRET_KEY
AWS_DEFAULT_REGION=us-east-1
AWS_S3_REGION=us-east-1

# S3 Buckets de staging
S3_BUCKET_NAME=dataclinica-staging-storage
S3_BUCKET_BACKUPS=dataclinica-staging-backups
S3_BUCKET_LOGS=dataclinica-staging-logs
S3_BUCKET_UPLOADS=dataclinica-staging-uploads

# CloudFront
CLOUDFRONT_DOMAIN=staging-cdn.dataclinica.com
CLOUDFRONT_DISTRIBUTION_ID=STAGING_DISTRIBUTION_ID

# =============================================================================
# APIs EXTERNAS (SANDBOX/TESTE)
# =============================================================================
# Memed API (Sandbox)
MEMED_API_URL=https://sandbox.memed.com.br/v1
MEMED_API_KEY=MEMED_SANDBOX_KEY
MEMED_SANDBOX=true

# ClickSign API (Sandbox)
CLICKSIGN_API_URL=https://sandbox.clicksign.com/api/v1
CLICKSIGN_API_KEY=CLICKSIGN_SANDBOX_KEY
CLICKSIGN_SANDBOX=true

# ViaCEP API
VIACEP_API_URL=https://viacep.com.br/ws

# Google APIs (desenvolvimento)
GOOGLE_MAPS_API_KEY=GOOGLE_MAPS_DEV_KEY
GOOGLE_ANALYTICS_ID=GA_STAGING_ID

# =============================================================================
# SAAS MULTIEMPRESA
# =============================================================================
MULTI_TENANT=true
DEFAULT_TENANT=dataclinica-staging
TENANT_ISOLATION=schema
MAX_TENANTS_PER_INSTANCE=10  # Limitado para staging

# =============================================================================
# CONFIGURAÇÕES DE STAGING
# =============================================================================
WORKERS=2  # Menos workers para staging
WORKER_CLASS=uvicorn.workers.UvicornWorker
WORKER_CONNECTIONS=500
MAX_REQUESTS=500
MAX_REQUESTS_JITTER=50
PRELOAD_APP=true
KEEP_ALIVE=2

# =============================================================================
# MONITORAMENTO E OBSERVABILIDADE
# =============================================================================
# Sentry para staging
SENTRY_DSN=SENTRY_STAGING_DSN
SENTRY_ENVIRONMENT=staging
SENTRY_RELEASE=1.0.0-staging

# Métricas
ENABLE_METRICS=true
METRICS_PORT=9000
METRICS_PATH=/metrics

# Health checks
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/api/health

# =============================================================================
# SEGURANÇA (MAIS PERMISSIVA PARA TESTES)
# =============================================================================
# Habilitar recursos de desenvolvimento para debug
ENABLE_SWAGGER=true
ENABLE_REDOC=true
ENABLE_PROFILER=true
ENABLE_DEBUG_TOOLBAR=true

# Rate Limiting (mais permissivo)
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=200
RATE_LIMIT_WINDOW=60
RATE_LIMIT_STORAGE=redis

# SSL/TLS
FORCE_HTTPS=true
SECURE_COOKIES=true
SECURE_HEADERS=true
HSTS_MAX_AGE=3600  # 1 hora para staging

# =============================================================================
# BACKUP E RECUPERAÇÃO
# =============================================================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 4 * * *  # Daily at 4 AM
BACKUP_RETENTION_DAYS=7  # Menor retenção para staging
BACKUP_STORAGE=s3
BACKUP_ENCRYPTION=true

# =============================================================================
# COMPLIANCE E AUDITORIA
# =============================================================================
# LGPD/GDPR (habilitado para testes)
LGPD_ENABLED=true
DATA_RETENTION_DAYS=365  # 1 ano para staging
ANONYMIZATION_ENABLED=true

# Auditoria
AUDIT_ENABLED=true
AUDIT_LOG_LEVEL=DEBUG
AUDIT_STORAGE=database

# Criptografia
DATA_ENCRYPTION=true
ENCRYPTION_ALGORITHM=AES-256-GCM
ENCRYPTION_KEY=STAGING_ENCRYPTION_KEY

# =============================================================================
# FRONTEND (REACT)
# =============================================================================
REACT_APP_API_URL=https://staging-api.dataclinica.com/api
REACT_APP_WS_URL=wss://staging-api.dataclinica.com/ws
REACT_APP_ENVIRONMENT=staging
REACT_APP_VERSION=1.0.0-staging
REACT_APP_SENTRY_DSN=FRONTEND_SENTRY_STAGING_DSN
REACT_APP_GOOGLE_ANALYTICS_ID=GA_STAGING_ID
REACT_APP_GOOGLE_MAPS_API_KEY=GOOGLE_MAPS_DEV_KEY

# =============================================================================
# DOMÍNIO E SSL
# =============================================================================
DOMAIN_NAME=staging.dataclinica.com
API_DOMAIN=staging-api.dataclinica.com
APP_DOMAIN=staging-app.dataclinica.com
SSL_CERT_PATH=/etc/nginx/ssl/staging-cert.pem
SSL_KEY_PATH=/etc/nginx/ssl/staging-key.pem

# =============================================================================
# GRAFANA E PROMETHEUS
# =============================================================================
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=staging_admin_password
PROMETHEUS_RETENTION_TIME=7d  # Menor retenção para staging

# =============================================================================
# CELERY (WORKERS ASSÍNCRONOS)
# =============================================================================
CELERY_BROKER_URL=redis://dataclinica-staging.cache.amazonaws.com:6379/1
CELERY_RESULT_BACKEND=redis://dataclinica-staging.cache.amazonaws.com:6379/2
CELERY_CONCURRENCY=2  # Menos workers para staging
CELERY_MAX_TASKS_PER_CHILD=500
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json
CELERY_TIMEZONE=America/Sao_Paulo

# =============================================================================
# NOTIFICAÇÕES E ALERTAS
# =============================================================================
# Slack (canal de staging)
SLACK_WEBHOOK_URL=SLACK_STAGING_WEBHOOK
SLACK_CHANNEL=#dataclinica-staging
SLACK_NOTIFICATIONS_ENABLED=true

# AWS SNS
SNS_TOPIC_ARN=arn:aws:sns:us-east-1:123456789012:dataclinica-staging-alerts
SNS_NOTIFICATIONS_ENABLED=true

# =============================================================================
# FEATURE FLAGS (PARA TESTES)
# =============================================================================
FEATURE_TELEMEDICINE=true
FEATURE_PRESCRIPTION_DIGITAL=true
FEATURE_DOCUMENT_SIGNING=true
FEATURE_ANALYTICS=true
FEATURE_MOBILE_APP=false  # Desabilitado em staging
FEATURE_MULTI_CLINIC=true
FEATURE_BETA_FEATURES=true  # Habilitar features beta

# =============================================================================
# CONFIGURAÇÕES AVANÇADAS
# =============================================================================
# Timezone
TIMEZONE=America/Sao_Paulo
LOCALE=pt_BR.UTF-8

# Upload de arquivos (mais permissivo)
MAX_UPLOAD_SIZE=100MB
ALLOWED_FILE_TYPES=pdf,jpg,jpeg,png,doc,docx,txt,csv,xlsx
UPLOAD_STORAGE=s3

# Sessões
SESSION_STORAGE=redis
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=Lax

# =============================================================================
# INTEGRAÇÕES
# =============================================================================
# Webhooks
WEBHOOK_SECRET=STAGING_WEBHOOK_SECRET
WEBHOOK_TIMEOUT=30
WEBHOOK_RETRIES=3

# APIs de terceiros
THIRD_PARTY_API_TIMEOUT=30
THIRD_PARTY_API_RETRIES=3
THIRD_PARTY_API_RATE_LIMIT=200  # Mais permissivo

# =============================================================================
# DOCKER E KUBERNETES
# =============================================================================
# Docker Registry
DOCKER_REGISTRY=dataclinica.azurecr.io
DOCKER_USERNAME=dataclinica
DOCKER_PASSWORD=REGISTRY_PASSWORD

# Kubernetes
KUBERNETES_NAMESPACE=dataclinica-staging
KUBERNETES_CLUSTER=dataclinica-staging-cluster

# =============================================================================
# CONFIGURAÇÕES DE TESTE
# =============================================================================
# Dados de teste
CREATE_TEST_DATA=true
TEST_USER_EMAIL=teste@dataclinica.com
TEST_USER_PASSWORD=teste123
TEST_CLINIC_NAME=Clínica de Teste

# Performance
SLOW_QUERY_THRESHOLD=1000  # 1 segundo
CACHE_DEBUG=true
SQL_DEBUG=true

# Limpeza automática
AUTO_CLEANUP_ENABLED=true
CLEANUP_SCHEDULE=0 6 * * 0  # Weekly on Sunday at 6 AM
CLEANUP_RETENTION_DAYS=30

# =============================================================================
# OBSERVAÇÕES PARA STAGING
# =============================================================================
# 1. Este ambiente é para testes finais antes da produção
# 2. Configurações mais permissivas para facilitar debug
# 3. Dados podem ser resetados periodicamente
# 4. Use dados de teste, nunca dados reais de pacientes
# 5. Monitore performance e logs regularmente
# 6. Teste todas as integrações antes do deploy em produção
# 7. Valide backups e procedimentos de recuperação
# 8. Teste cenários de falha e recuperação
# 9. Verifique compatibilidade com diferentes browsers
# 10. Execute testes de carga e stress