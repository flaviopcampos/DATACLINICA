option_settings:
  aws:elasticbeanstalk:application:environment:
    # Database Configuration
    DATABASE_URL: "postgresql://username:password@host:5432/dataclinica"
    
    # Security
    SECRET_KEY: "your-secret-key-here"
    JWT_SECRET_KEY: "your-jwt-secret-key-here"
    JWT_ALGORITHM: "HS256"
    JWT_EXPIRE_MINUTES: "30"
    
    # CORS Configuration
    CORS_ORIGINS: "https://yourdomain.com,https://www.yourdomain.com"
    
    # Email Configuration
    SMTP_SERVER: "smtp.gmail.com"
    SMTP_PORT: "587"
    SMTP_USERNAME: "your-email@gmail.com"
    SMTP_PASSWORD: "your-app-password"
    SMTP_FROM_EMAIL: "noreply@yourdomain.com"
    
    # AWS S3 Configuration
    AWS_S3_BUCKET: "dataclinica-files"
    AWS_S3_REGION: "us-east-1"
    
    # External APIs
    MEMED_API_KEY: "your-memed-api-key"
    MEMED_API_URL: "https://api.memed.com.br"
    CLICKSIGN_API_KEY: "your-clicksign-api-key"
    CLICKSIGN_API_URL: "https://api.clicksign.com"
    VIACEP_API_URL: "https://viacep.com.br/ws"
    
    # Redis Configuration (ElastiCache)
    REDIS_URL: "redis://your-elasticache-endpoint:6379"
    
    # Monitoring
    SENTRY_DSN: "your-sentry-dsn"
    
    # SaaS Configuration
    SAAS_MODE: "true"
    DEFAULT_PLAN: "free"
    TRIAL_DAYS: "30"
    
    # Backup Configuration
    BACKUP_ENABLED: "true"
    BACKUP_SCHEDULE: "0 2 * * *"  # Daily at 2 AM
    BACKUP_RETENTION_DAYS: "30"
    
    # SSL/TLS
    SSL_REDIRECT: "true"
    SECURE_COOKIES: "true"
    
    # Logging
    LOG_LEVEL: "INFO"
    LOG_FORMAT: "json"
    
  # Load Balancer Configuration
  aws:elasticbeanstalk:environment:
    LoadBalancerType: application
    
  aws:elbv2:loadbalancer:
    SecurityGroups: sg-12345678
    ManagedSecurityGroup: sg-87654321
    
  aws:elbv2:listener:443:
    ListenerEnabled: true
    Protocol: HTTPS
    SSLCertificateArns: arn:aws:acm:region:account:certificate/certificate-id
    
  aws:elbv2:listener:80:
    ListenerEnabled: true
    Protocol: HTTP
    
  # Auto Scaling Configuration
  aws:autoscaling:asg:
    MinSize: 1
    MaxSize: 10
    Cooldown: 360
    
  aws:autoscaling:trigger:
    MeasureName: CPUUtilization
    Statistic: Average
    Unit: Percent
    LowerThreshold: 20
    UpperThreshold: 70
    ScaleUpIncrement: 1
    ScaleDownIncrement: -1
    
  # Health Check Configuration
  aws:elasticbeanstalk:healthreporting:system:
    SystemType: enhanced
    HealthCheckSuccessThreshold: Ok
    
  aws:elasticbeanstalk:application:
    Application Healthcheck URL: /health
    
  # CloudWatch Logs
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 30
    
  aws:elasticbeanstalk:cloudwatch:logs:health:
    HealthStreamingEnabled: true
    DeleteOnTerminate: false
    RetentionInDays: 7

Resources:
  AWSEBSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security group for DataClinica application
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: 443
          ToPort: 443
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: 10.0.0.0/8  # Restrict SSH access
      SecurityGroupEgress:
        - IpProtocol: -1
          CidrIp: 0.0.0.0/0